// Yeumbeul Nord zone boundary polygon (converted from UTM EPSG:32628 to WGS84)
// Original UTM coordinates converted to lat/lon

// UTM Zone 28N parameters for coordinate conversion
const UTM_ZONE = 28;
const FALSE_EASTING = 500000;
const FALSE_NORTHING = 0;
const SCALE_FACTOR = 0.9996;
const EQUATORIAL_RADIUS = 6378137;
const FLATTENING = 1 / 298.257223563;

function utmToLatLon(easting: number, northing: number): { lat: number; lon: number } {
  const e = Math.sqrt(2 * FLATTENING - FLATTENING * FLATTENING);
  const e2 = e * e;
  const e1 = (1 - Math.sqrt(1 - e2)) / (1 + Math.sqrt(1 - e2));
  
  const x = easting - FALSE_EASTING;
  const y = northing - FALSE_NORTHING;
  
  const centralMeridian = (UTM_ZONE - 1) * 6 - 180 + 3;
  
  const M = y / SCALE_FACTOR;
  const mu = M / (EQUATORIAL_RADIUS * (1 - e2 / 4 - 3 * e2 * e2 / 64 - 5 * e2 * e2 * e2 / 256));
  
  const phi1 = mu + (3 * e1 / 2 - 27 * e1 * e1 * e1 / 32) * Math.sin(2 * mu)
    + (21 * e1 * e1 / 16 - 55 * e1 * e1 * e1 * e1 / 32) * Math.sin(4 * mu)
    + (151 * e1 * e1 * e1 / 96) * Math.sin(6 * mu);
  
  const N1 = EQUATORIAL_RADIUS / Math.sqrt(1 - e2 * Math.sin(phi1) * Math.sin(phi1));
  const T1 = Math.tan(phi1) * Math.tan(phi1);
  const C1 = (e2 / (1 - e2)) * Math.cos(phi1) * Math.cos(phi1);
  const R1 = EQUATORIAL_RADIUS * (1 - e2) / Math.pow(1 - e2 * Math.sin(phi1) * Math.sin(phi1), 1.5);
  const D = x / (N1 * SCALE_FACTOR);
  
  const lat = phi1 - (N1 * Math.tan(phi1) / R1) * (
    D * D / 2
    - (5 + 3 * T1 + 10 * C1 - 4 * C1 * C1 - 9 * (e2 / (1 - e2))) * D * D * D * D / 24
    + (61 + 90 * T1 + 298 * C1 + 45 * T1 * T1 - 252 * (e2 / (1 - e2)) - 3 * C1 * C1) * D * D * D * D * D * D / 720
  );
  
  const lon = (centralMeridian * Math.PI / 180) + (
    D
    - (1 + 2 * T1 + C1) * D * D * D / 6
    + (5 - 2 * C1 + 28 * T1 - 3 * C1 * C1 + 8 * (e2 / (1 - e2)) + 24 * T1 * T1) * D * D * D * D * D / 120
  ) / Math.cos(phi1);
  
  return {
    lat: lat * 180 / Math.PI,
    lon: lon * 180 / Math.PI
  };
}

// UTM coordinates from the GeoJSON file
const utmCoordinates = [
  [246168.529400000348687, 1637519.028699999675155],
  [246363.433199999853969, 1637108.775800000876188],
  [246366.620500000193715, 1637099.963199999183416],
  [246373.477900000289083, 1637091.734400000423193],
  [246411.193400000222027, 1637076.648199999704957],
  [246448.223100000061095, 1637062.247700000181794],
  [246496.224700000137091, 1637040.989900000393391],
  [246563.426900000311434, 1637017.674900000914931],
  [246624.457399999722838, 1636996.416999999433756],
  [246668.344600000418723, 1636976.5307],
  [246722.311499999836087, 1636961.2489],
  [246763.897699999623001, 1636949.797700000926852],
  [246798.854199999943376, 1636937.743699999526143],
  [246833.810600000433624, 1636929.908600000664592],
  [246869.972500000149012, 1636923.278899999335408],
  [246898.299300000071526, 1636919.662699999287724],
  [246979.663599999621511, 1636908.211500000208616],
  [247059.822399999946356, 1636893.7467],
  [247114.065299999900162, 1636888.3224],
  [247203.433299999684095, 1636884.127699999138713],
  [247229.662800000049174, 1636869.855799999088049],
  [247297.165000000037253, 1636830.511600000783801],
  [247371.6102, 1636789.624600000679493],
  [247420.597500000149012, 1636759.923599999397993],
  [247480.770899999886751, 1636723.665300000458956],
  [247529.758200000040233, 1636690.492799999192357],
  [247592.711900000460446, 1636648.961500000208616],
  [247673.369099999777973, 1636596.616599999368191],
  [247754.130699999630451, 1636555.633099999278784],
  [247830.887400000356138, 1636517.224300000816584],
  [247867.892699999734759, 1636499.6195],
  [247887.509200000204146, 1636485.76659999974072],
  [247970.79079999960959, 1636437.091900000348687],
  [248021.276600000448525, 1636404.50650000013411],
  [248070.773199999704957, 1636369.5877],
  [248102.153500000014901, 1636346.2379],
  [248137.644399999640882, 1636314.454900000244379],
  [248176.3136, 1636280.023499999195337],
  [248224.61699999962002, 1636237.778699999675155],
  [248275.86699999962002, 1636196.659499999135733],
  [248353.768199999816716, 1636151.832399999722838],
  [248565.12459999974817, 1636026.819599999114871],
  [248722.987999999895692, 1635935.220300000160933],
  [249030.78139999974519, 1635774.857300000265241],
  [248869.280399999581277, 1635506.2752],
  [248830.379399999976158, 1635462.408099999651313],
  [248817.136500000022352, 1635428.473300000652671],
  [248775.752600000239909, 1635364.741900000721216],
  [248752.577499999664724, 1635358.948100000619888],
  [248645.393000000156462, 1635245.918099999427795],
  [248628.580699999816716, 1635257.557399999350309],
  [248578.144000000320375, 1635177.375900000333786],
  [248557.451999999582767, 1635186.428600000217557],
  [248523.827499999664724, 1635125.645899999886751],
  [248288.456000000238419, 1634732.497899999842048],
  [248098.348299999721348, 1634378.147399999201298],
  [248019.459999999962747, 1634234.596699999645352],
  [247925.523000000044703, 1634069.051300000399351],
  [248000.8602, 1634060.575899999588728],
  [248029.111700000241399, 1633982.4134],
  [247993.326500000432134, 1633984.296900000423193],
  [247995.20990000013262, 1633954.162000000476837],
  [247946.240699999965727, 1633799.720599999651313],
  [247001.699699999764562, 1634119.903999999165535],
  [246839.724600000306964, 1634173.581800000742078],
  [246716.3597999997437, 1634219.72580000013113],
  [246540.553299999795854, 1634281.40819999948144],
  [246432.491399999707937, 1634317.958599999547005],
  [246291.587199999950826, 1634366.692399999126792],
  [246193.060100000351667, 1634401.123800000175834],
  [246106.186900000087917, 1634428.668999999761581],
  [246009.778699999675155, 1634462.04109999909997],
  [245932.67200000025332, 1634485.745799999684095],
  [245889.632699999958277, 1634499.816400000825524],
  [245864.802299999631941, 1634502.2994],
  [245835.005800000391901, 1634508.92090000025928],
  [245806.864699999801815, 1634514.714600000530481],
  [245792.794099999591708, 1634537.889699999243021],
  [245781.206600000150502, 1634557.754000000655651],
  [245750.582499999552965, 1634560.236999999731779],
  [245714.727400000207126, 1634557.91950000077486],
  [245679.236399999819696, 1634548.91440000012517],
  [245648.513000000268221, 1634533.5526],
  [245622.556900000199676, 1634513.953199999406934],
  [245590.180700000375509, 1634478.886],
  [245531.869699999690056, 1634503.973300000652671],
  [245471.524500000290573, 1634435.491800000891089],
  [245454.234600000083447, 1634407.692299999296665],
  [245439.317900000140071, 1634366.67119999974966],
  [245423.745900000445545, 1634275.657400000840425],
  [245359.002600000239909, 1634287.296599999070168],
  [245308.808299999684095, 1634312.029999999329448],
  [245351.088700000196695, 1634418.428600000217557],
  [245235.683600000105798, 1634490.636600000783801],
  [245227.691599999554455, 1634502.62470000050962],
  [245256.662700000219047, 1634718.409700000658631],
  [245248.670699999667704, 1634729.398800000548363],
  [245205.713499999605119, 1634774.354000000283122],
  [245187.731399999931455, 1634797.3311],
  [245172.746299999766052, 1634807.321100000292063],
  [245155.763299999758601, 1634816.31220000050962],
  [245120.798100000247359, 1634824.304199999198318],
  [245095.822999999858439, 1634833.295299999415874],
  [245070.847900000400841, 1634845.283299999311566],
  [245050.86780000012368, 1634859.269400000572205],
  [245023.894600000232458, 1634887.241499999538064],
  [244995.922500000335276, 1634917.21169999986887],
  [244968.949400000274181, 1634948.180800000205636],
  [244902.255800000391901, 1635027.741599999368191],
  [245001.916500000283122, 1635123.0066],
  [245059.858799999579787, 1635183.945900000631809],
  [245085.832899999804795, 1635225.904100000858307],
  [245120.798100000247359, 1635261.868300000205636],
  [245159.759300000034273, 1635294.8355],
  [245205.713499999605119, 1635329.800599999725819],
  [245239.679700000211596, 1635360.769799999892712],
  [245321.598000000230968, 1635426.70409999974072],
  [245340.57909999974072, 1635454.676200000569224],
  [245357.562199999578297, 1635479.6513],
  [245446.849000000394881, 1635610.816099999472499],
  [245527.792500000447035, 1635735.6612],
  [245614.223799999803305, 1635863.250099999830127],
  [245703.069600000046194, 1636018.551999999210238],
  [245743.458999999798834, 1636105.477099999785423],
  [245744.337100000120699, 1636130.939999999478459],
  [245731.166600000113249, 1636262.6447],
  [245710.971900000236928, 1636277.57120000012219],
  [245697.801400000229478, 1636293.375800000503659],
  [245681.118800000287592, 1636367.1305],
  [245669.427600000053644, 1636403.091600000858307],
  [245650.134899999946356, 1636448.911699999123812],
  [245613.961199999786913, 1636527.28830000013113],
  [245583.816300000064075, 1636583.9605],
  [245546.43680000025779, 1636661.131300000473857],
  [245517.497700000181794, 1636723.832499999552965],
  [245440.326999999582767, 1636914.347699999809265],
  [245357.015399999916553, 1637104.731799999251962],
  [245354.54590000025928, 1637198.077500000596046],
  [245366.339599999599159, 1637203.448599999770522],
  [245402.802699999883771, 1637218.207499999552965],
  [245437.095499999821186, 1637224.718800000846386],
  [245475.729100000113249, 1637234.268699999898672],
  [245507.851400000043213, 1637262.918299999088049],
  [245527.819299999624491, 1637275.072699999436736],
  [245557.771200000308454, 1637280.715800000354648],
  [245583.382299999706447, 1637285.924799999222159],
  [245635.472500000149012, 1637306.760900000110269],
  [245685.392300000414252, 1637327.596999999135733],
  [245728.800900000147521, 1637337.1469],
  [245836.806699999608099, 1637395.232999999076128],
  [245877.502199999988079, 1637406.085100000724196],
  [245899.206500000320375, 1637412.86769999936223],
  [245946.006299999542534, 1637432.537200000137091],
  [246003.142799999564886, 1637457.388599999248981],
  [246052.194500000216067, 1637463.031700000166893],
  [246138.143400000408292, 1637517.292400000616908],
  [246168.529400000348687, 1637519.028699999675155]
];

// Convert UTM to lat/lon and create the polygon
export const YEUMBEUL_NORD_POLYGON: [number, number][] = utmCoordinates.map(([easting, northing]) => {
  const { lat, lon } = utmToLatLon(easting, northing);
  return [lat, lon];
});

/**
 * Check if a point is inside a polygon using ray casting algorithm
 */
export function isPointInPolygon(lat: number, lon: number, polygon: [number, number][]): boolean {
  let inside = false;
  const n = polygon.length;
  
  for (let i = 0, j = n - 1; i < n; j = i++) {
    const [yi, xi] = polygon[i];
    const [yj, xj] = polygon[j];
    
    if (((yi > lon) !== (yj > lon)) && 
        (lat < (xj - xi) * (lon - yi) / (yj - yi) + xi)) {
      inside = !inside;
    }
  }
  
  return inside;
}

/**
 * Check if a lampadaire is within the Yeumbeul Nord zone
 */
export function isInYeumbeulNord(lat: number, lon: number): boolean {
  return isPointInPolygon(lat, lon, YEUMBEUL_NORD_POLYGON);
}
